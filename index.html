<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>ç¾è‚¡AIæŠ•è³‡å»ºè­°</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.0.2/marked.min.js"></script>

    <style>
        /* å…¨åŸŸåŸºç¤è¨­å®š */
        body {
            background-color: #f1f5f9; /* å¤–éƒ¨ç¶²é èƒŒæ™¯è‰² */
            margin: 0;
            padding: 20px 10px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* ğŸŸ¢ æ”¾å¤§ç‰ˆå°å·¥å…·å®¹å™¨ (max-width å¾ 380px æ”¾å¤§è‡³ 500px) */
        #ai-portfolio-widget {
            max-width: 500px;
            margin: 0 auto;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
            background: white;
            border: 1px solid #e2e8f0;
        }

        /* å‹•ç•«èˆ‡ç¾åŒ– */
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }
        .skeleton { background-color: #e2e8f0; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .live-dot { box-shadow: 0 0 8px #22c55e; animation: pulse 1.5s infinite; }
        
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        
        .markdown-content p { margin-bottom: 8px; }
        .markdown-content ul { padding-left: 20px; margin-bottom: 8px; }
    </style>
</head>
<body>

    <div id="ai-portfolio-widget">
        
        <div style="background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); color: white; padding: 24px; display: flex; justify-content: space-between; align-items: center;">
            <div>
                <div style="font-weight: 900; font-size: 22px; letter-spacing: 0.5px;">ç¾è‚¡AIæŠ•è³‡å»ºè­°</div>
                <div id="widget-status" style="font-size: 12px; color: #94a3b8; margin-top: 4px; font-weight: 500;">Connecting...</div>
            </div>
            <div style="display: flex; align-items: center; gap: 6px; background: rgba(34, 197, 94, 0.15); padding: 6px 10px; border-radius: 8px;">
                <div class="live-dot" style="width: 8px; height: 8px; background: #22c55e; border-radius: 50%;"></div>
                <span style="font-size: 11px; color: #4ade80; font-weight: 900; letter-spacing: 0.5px;">LIVE</span>
            </div>
        </div>

        <div id="skeleton-loader" style="padding: 24px;">
            <div class="skeleton" style="width: 100px; height: 16px; margin-bottom: 20px; border-radius: 4px;"></div>
            <div style="display: flex; gap: 10px; margin-bottom: 30px;">
                <div class="skeleton" style="width: 80px; height: 32px; border-radius: 12px;"></div>
                <div class="skeleton" style="width: 90px; height: 32px; border-radius: 12px;"></div>
            </div>
            <div class="skeleton" style="width: 100%; height: 70px; margin-bottom: 16px; border-radius: 16px;"></div>
            <div class="skeleton" style="width: 100%; height: 70px; border-radius: 16px;"></div>
        </div>

        <div id="widget-content" style="display: none;">
            
            <div style="padding: 20px; border-bottom: 1px solid #f1f5f9; background: #f8fafc;">
                <div style="font-size: 12px; font-weight: 900; color: #64748b; text-transform: uppercase; margin-bottom: 12px; letter-spacing: 1px;">ğŸ’¼ ç•¶å‰æŒå€‰ (Live Data)</div>
                <div id="holdings-container" style="display: flex; flex-wrap: wrap; gap: 10px;"></div>
            </div>

            <div style="padding: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <div style="font-size: 12px; font-weight: 900; color: #64748b; text-transform: uppercase; letter-spacing: 1px;">ğŸ“¢ AI æœ€æ–°æ“ä½œå»ºè­°</div>
                </div>
                <div id="rec-list" class="custom-scroll" style="max-height: 600px; overflow-y: auto; padding-right: 8px;"></div>
            </div>
        </div>

        <div style="background: #f8fafc; padding: 14px; text-align: center; font-size: 11px; color: #cbd5e1; border-top: 1px solid #f1f5f9; font-weight: 600;">
            Powered by Google Gemini 1.5 Pro
        </div>
    </div>

    <script>
    (function() {
        // ============================================================
        // ğŸ”´ è«‹å¡«å…¥æ‚¨çš„ Apps Script ç¶²å€
        // ============================================================
        const API_URL = 'https://script.google.com/macros/s/AKfycbwmeeME_OntMnpA5bmX6pYhH_HlRArMZPiqzQP39aPPpirWt_uiKNz2MSiYMY4qdFqH/exec'; 
        // ============================================================

        // ç¢ºä¿ç¶²é è¼‰å…¥æ™‚å¼·åˆ¶ä¿®æ”¹ Title
        document.title = "ç¾è‚¡AIæŠ•è³‡å»ºè­°";

        function loadWidgetData() {
            fetch(API_URL + '?action=public_board')
                .then(res => res.json())
                .then(json => {
                    document.getElementById('skeleton-loader').style.display = 'none';
                    document.getElementById('widget-content').style.display = 'block';
                    document.getElementById('widget-status').innerText = 'GPT + Gemini â€¢ è‡ªå‹•åˆ·æ–°ä¸­';

                    // æ¸²æŸ“æŒå€‰ (å­—é«”èˆ‡å…§è·æ”¾å¤§)
                    const hBox = document.getElementById('holdings-container');
                    if (json.holdings && json.holdings.length > 0) {
                        hBox.innerHTML = json.holdings.map(sym => {
                            const market = json.liveMarket?.[sym] || { change: 0 };
                            const isUp = market.change >= 0;
                            const changeHtml = `<span style="color: ${isUp ? '#16a34a' : '#dc2626'}; font-size: 11px; margin-left: 6px;">${isUp?'â–²':'â–¼'}${Math.abs(market.change).toFixed(2)}%</span>`;
                            return `
                            <a href="https://www.google.com/search?q=finance+${sym}" target="_blank" 
                               style="text-decoration: none; background: white; color: #0f172a; border: 1px solid #e2e8f0; padding: 8px 14px; border-radius: 12px; font-size: 14px; font-weight: 800; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: transform 0.1s;"
                               onmousedown="this.style.transform='scale(0.96)'" onmouseup="this.style.transform='scale(1)'" onmouseleave="this.style.transform='scale(1)'">
                               ${sym} ${changeHtml}
                            </a>`;
                        }).join('');
                    } else {
                        hBox.innerHTML = '<span style="font-size:13
